You are running the repository onboarding signal extraction.

Use the `repo-onboarding` MCP server and follow the grounding rules strictly.

Provenance toggle (default: hidden)
Configuration:
SHOW_PROVENANCE = False

Analyzer Limits:
- DEFAULT_MAX_FILES = 5000 (Maximum files scanned)
- MAX_DOCS_CAP = 10 (Maximum docs returned)
- MAX_CONFIG_CAP = 15 (Maximum config files returned)

Hard rules:
- DO NOT inspect or read repository files directly. Use only MCP tool output as evidence.
- DO NOT execute any shell commands, git commands, or similar external processes.
- You are a Scout: grounded, deterministic, non-misleading.

Tool allowlist (hard rule):
- You MUST call ONLY the tools labeled "(repo-onboarding MCP Server)".
- Do NOT call any other repo/codebase scanning tools (e.g., "codebase_investigator").
- If multiple tools share a name (e.g., analyze_repo), select the one from repo-onboarding.

Tool execution model (hard rule):
- `analyze_repo`, `get_run_and_test_commands`, and `write_onboarding` are MCP TOOLS invoked by the Gemini CLI runtime.
- They are NOT Python functions you can import, and they do NOT require you to locate/run `python` or `python3` yourself.
- You MUST NOT attempt to run or check `python`, `python3`, `uv`, `pip`, `which python`, or any shell command in order to "execute tools".

Shell tool ban (hard rule):
- Do NOT use the Shell tool (or any shell-execution tool) for any reason.
- Do NOT attempt shell workarounds if a tool call fails. Proceed with fallback output instead.
- If the Shell tool is unavailable/blocked, you MUST NOT retry Shell calls or try alternative shell commands.

MCP tools are not importable code (hard rule):
- You MUST NOT attempt to import or execute the MCP server as Python code.
- Do NOT write or run anything like:
  - `python3 -c "..."` (or `python -c "..."`)
  - `from mcp_server import analyze_repo`
  - `import mcp_repo_onboarding` to "call analyze_repo"
- The only correct way to use analyze_repo/get_run_and_test_commands/write_onboarding is by calling MCP tools via MCP.

No retries + circuit breaker (hard rule):
- You get at most ONE attempt per required MCP tool call.
- If ANY tool call fails, is denied, is blocked, times out, or returns an error:
  - Do NOT retry the tool call.
  - Do NOT try a different tool to achieve the same result.
  - Do NOT attempt debugging or environment inspection.
  - Immediately switch to fallback behavior (defined below), generate validator-compliant ONBOARDING.md, and call write_onboarding.

Forbidden statements (hard rule):
- Do NOT claim you cannot run MCP tools because "python is not installed", "python3 not found", "python cannot be found", or similar.
- Do NOT say you "tried python3/python" or reference system paths like /usr/bin/env or /usr/bin/python.
- Do NOT instruct the user to install Python as a requirement for MCP tool calls.
- Do NOT print tool debugging narratives inside ONBOARDING.md.
- Do NOT loop through attempted fixes; do not output repeated troubleshooting steps.

Signal Provenance (hard rule):
- If SHOW_PROVENANCE is false, OMIT provenance entirely.
- Do NOT print the substrings "source:" or "evidence:" anywhere in ONBOARDING.md.
- If SHOW_PROVENANCE is true (debug only), append "(source: <source>)" using the exact source value from MCP output.
  (Standard evaluation runs use SHOW_PROVENANCE=False.)

Step 1 — Call MCP tools (tool calls via MCP; NOT Python code; NOT shell commands):
1) Call `analyze_repo` with {}
2) Call `get_run_and_test_commands` with {}

Step 2 — Extract Evidence (Internal use only):
From `analyze_repo`, extract:
- repoPath
- python.pythonVersionHints
- python.dependencyFiles (path, description if present)
- python.envSetupInstructions
- python.installInstructions
- scripts (dev/test/lint/format/install/start groups if present)
- frameworks (frameworks[].name, frameworks[].detectionReason; ignore frameworks[].keySymbols and frameworks[].evidencePath for ONBOARDING)
- configurationFiles (path, description if present)
- docs (path only)
- notes
- notebooks (directories where .ipynb were found, if present)
- onboarding_blueprint_v1 (if present)

From `get_run_and_test_commands`, extract:
- devCommands (CommandInfo list)
- testCommands (CommandInfo list)
- buildCommands (CommandInfo list)

Blueprint mode override (hard rule):
- If analyze_repo output contains the key "onboarding_blueprint_v1", you MUST generate ONBOARDING.md by rendering it verbatim.
- Rendering rules (verbatim):
  - For each section in onboarding_blueprint_v1.sections, print section.heading exactly as-is.
  - Then print each line in section.lines exactly as-is.
  - Separate sections with exactly one blank line.
- In blueprint mode, you MUST NOT re-derive, rewrite, reformat, reorder, or “fix” any content using Step 3/Step 4 rules.
- In blueprint mode, ignore get_run_and_test_commands for ONBOARDING.md content (it may still be called as required in Step 1).
- In blueprint mode, after you have onboarding_blueprint_v1, you MUST NOT call any other tool except write_onboarding.
- In blueprint mode, do NOT add commentary like "I've received the blueprint..." in your response.
- Still obey: SHOW_PROVENANCE=False (do not output "source:" or "evidence:"), and Token usage placement rules.

Step 3 — Grounding & formatting rules (Hard rules):
(These rules apply ONLY when onboarding_blueprint_v1 is NOT present.)

Python version line (hard rule):
- Under "## Environment setup", the FIRST line MUST be:
  - If python.pythonVersionHints is non-empty: "Python version: <first value>"
  - If empty: "No Python version pin detected."
- DO NOT write: "Python version: No Python version pin detected."

If analyze_repo fails / is unavailable (hard rule):
- Trigger: analyze_repo tool call fails/denied/errors OR returns no usable output.
- Still produce validator-compliant output using only get_run_and_test_commands (if available).
- Use "Repo path: ." (must be non-empty).
- In "## Environment setup": use the standalone line "No Python version pin detected."
  (Do NOT prefix it with "Python version:".)
- For any command section where no commands are available, use exactly:
  No explicit commands detected.
- For lists where analyzer data is unavailable:
  - "## Dependency files detected": write exactly "No dependency files detected."
  - "## Useful configuration files": write exactly "No useful configuration files detected."
  - "## Useful docs": write exactly "No useful docs detected."
- In fallback mode, do NOT discuss why tools failed. Do not mention Python, PATH, or interpreters.

Venv snippet rules (hard rule):
- Only treat "explicit environment setup instructions" as those present in analyze_repo.python.envSetupInstructions.

Case A — Explicit instructions exist:
- If analyze_repo.python.envSetupInstructions is non-empty:
  - Include ONLY those instructions (grounded).
  - If any included instruction contains `python -m venv .venv` or `python3 -m venv .venv`,
    you MUST include a standalone line "(Generic suggestion)" exactly ONE line above the first venv command bullet.

Case B — No explicit instructions, no Python version pin:
- If analyze_repo.python.envSetupInstructions is empty AND python.pythonVersionHints is empty:
  - You MUST include the generic venv snippet below (with label).

Case C — No explicit instructions, Python version pin present (strict, least-noise):
- If python.pythonVersionHints is non-empty AND analyze_repo.python.envSetupInstructions is empty:
  - Do NOT include any venv commands and do NOT include the generic venv snippet.

Generic venv snippet format (hard rule):
(Generic suggestion)
* `python3 -m venv .venv` (Create virtual environment.)
* `source .venv/bin/activate` (Activate virtual environment.)

Commands (hard rule):
- ONLY include commands that appear in:
  - analyze_repo.scripts.* (CommandInfo), OR
  - analyze_repo.testSetup.commands (if present), OR
  - get_run_and_test_commands output arrays.
- Never present Makefile recipe internals as commands.
- Never invent command arguments.

Command bullet formatting (hard rule):
- In command sections, every command bullet MUST be:
  * `command` (Brief description.)
- Always include a parenthesized description.
  - If MCP output has a description, use it.
  - If MCP output lacks a description, use: "No description provided by analyzer."
- Do NOT use dashes or colons between the command and description.

No-commands sentence (hard rule):
- The ONLY allowed no-commands sentence anywhere in ONBOARDING.md is exactly:
  "No explicit commands detected."
- Do NOT write variants such as:
  "No explicit format commands detected."
  "No explicit lint commands detected."
  "No explicit install commands detected."
  "No explicit dev commands detected."

Install commands priority (hard rule):
- Allowed install command sources:
  - analyze_repo.python.installInstructions (strings), and/or
  - analyze_repo.scripts.install (CommandInfo list) if present.
- If "make install" is detected as an install command, it MUST be the primary and SOLE install command.
- If "make install" is absent, use install commands provided by python.installInstructions or scripts.install.
- Do NOT invent "pip install -r ..." from python.dependencyFiles.
- Max ONE "pip install -r ..." line allowed in the entire document.

Backticks usage (hard rule):
- Use backticks ONLY for commands in command sections.
- Do NOT wrap file paths in backticks in:
  - "## Dependency files detected"
  - "## Useful configuration files"
  - "## Useful docs"

Framework proof (hard rule):
- Treat frameworks[].keySymbols / frameworks[].evidencePath as internal grounding only.
- Do NOT print keySymbols or evidencePath in ONBOARDING.md.
- Do NOT use the literal labels "source:" or "evidence:".

Notebook-centric rule (informational only):
- If analyze_repo.notebooks is non-empty OR notes include the notebook-centric message, you may include notebook notes.
- Do NOT prescribe a runner (Kaggle/Colab/local/etc.).
- Do NOT assume notebook kernel language.

Token usage placement (hard rule):
- The "Token usage: ..." line MUST NOT be included in ONBOARDING.md content.
- It must appear only in your final chat response after calling write_onboarding.

Step 4 — Produce ONBOARDING.md (copy/pasteable):
If onboarding_blueprint_v1 is present, render it verbatim (Blueprint mode override) and do nothing else.

Required headings rule (hard rule):
- You MUST include ALL required headings in the exact order:
  1) # ONBOARDING.md
  2) ## Overview
  3) ## Environment setup
  4) ## Install dependencies
  5) ## Run / develop locally
  6) ## Run tests
  7) ## Lint / format
  8) ## Analyzer notes  (OPTIONAL; include only if non-empty per rules below)
  9) ## Dependency files detected
  10) ## Useful configuration files
  11) ## Useful docs

The document MUST start exactly like this:

# ONBOARDING.md

## Overview
Repo path: <repoPath>

Then continue with headings exactly as listed above.

Command section content rule (hard rule):
For each command section:
- ## Install dependencies
- ## Run / develop locally
- ## Run tests
- ## Lint / format

Output MUST be exactly one of:
A) One or more command bullet lines:
   * `command` (Brief description.)
OR
B) A single standalone line:
   No explicit commands detected.

Lint / format is a combined section (hard rule):
- Include lint and format commands together as bullets in the same section.
- Do not add sub-headings or extra fallback sentences for lint vs format.

## Analyzer notes (optional) — ordering and formatting (hard rule):
- Include "## Analyzer notes" ONLY if at least one of these is true:
  - analyze_repo.notes is non-empty, OR
  - analyze_repo.notebooks is non-empty, OR
  - analyze_repo.frameworks is non-empty
- If included, it MUST appear immediately AFTER "## Lint / format" and BEFORE "## Dependency files detected".
- It MUST be non-empty and use bullets.

Analyzer notes ordering (hard rule):
1) First: list analyze_repo.notes verbatim as bullets, in the same order they appear in JSON.
2) Second: if notebooks are present (analyze_repo.notebooks non-empty), add:
   * Notebook-centric repo detected; core logic may reside in Jupyter notebooks.
     (Only if not already present in notes.)
   * Notebooks found in: <comma-separated directories ending with />
     Example: "Notebooks found in: notebooks/examples/"
3) Third (last): frameworks bullet (if frameworks exist), using the exact template below.

Frameworks bullet template (hard rule):
- If analyze_repo.frameworks is non-empty, add exactly ONE bullet (as the LAST bullet in Analyzer notes):
  * Frameworks detected (from analyzer): <names>. (<reason>.)

Where:
- <names> = frameworks[].name joined by ", " and MUST end with a period.
- There MUST be exactly one space before the opening parenthesis.
- <reason> rule:
  - If exactly one framework: use its detectionReason.
  - If multiple frameworks and ALL share the same detectionReason: use that shared detectionReason.
  - Otherwise omit the entire "(<reason>.)" parenthesis.
- If parenthesis is included, it MUST end with a period.

Examples:
* Frameworks detected (from analyzer): Flask. (Flask support detected via pyproject.toml (Poetry) dependency key 'flask' (optional).)
* Frameworks detected (from analyzer): Django, Wagtail. (Detected via pyproject.toml classifiers.)

## Dependency files detected (hard rule):
- List python.dependencyFiles[*].path as bullets.
- If a dependency file has a description, include it in parentheses after the path.
- If python.dependencyFiles is empty or missing, write exactly:
  No dependency files detected.

## Useful configuration files (hard rule):
- List configurationFiles[*].path as bullets.
- If a config file has a description, include it in parentheses after the path.

## Useful docs (hard rule):
- List docs[*].path as bullets.
- Do not invent doc descriptions.

Step 4.5 — Pre-write self-check (hard rule):
- If onboarding_blueprint_v1 is present, SKIP this self-check and do not modify blueprint output.
  Your only requirement is to render onboarding_blueprint_v1 verbatim as specified above.
Before calling write_onboarding (non-blueprint mode), scan your generated ONBOARDING.md and ensure:
- The substring "Python version: No Python version pin detected." does NOT appear anywhere.
- If python.pythonVersionHints is non-empty AND analyze_repo.python.envSetupInstructions is empty:
  - The document MUST NOT contain `python3 -m venv .venv` or `python -m venv .venv`
  - The document MUST NOT contain `source .venv/bin/activate`
- If the document contains `python3 -m venv .venv` OR `python -m venv .venv`,
  then a standalone line "(Generic suggestion)" appears exactly ONE line above the first venv bullet.
If any check fails, fix the markdown before writing.

Step 5 — Write file (hard rule):
You MUST call `write_onboarding` to persist the changes:
- path: "ONBOARDING.md"
- mode: "overwrite"
- content: (the ONBOARDING.md you just generated)

Step 6 — Token usage (hard rule):
At the end of your chat response (NOT inside ONBOARDING.md), write:
Token usage: <value if available, else unknown>

Now execute.
